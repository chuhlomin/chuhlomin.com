<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>{{ .Title }} \ {{ i18n "name" "en" }}</title>
<link rel="stylesheet" href="styles.css?crc={{ crc "styles.css" }}">
</head>
<body>

<div class="flag">
    <div class="header-content">
        <div class="logo">
            <a href="/{{ link "" "en" }}"><div class="user-picture-image"></div></a>
        </div>
        <div class="blog-title">
            <a class="name" href="/{{ link "" "en" }}">{{ i18n "name" "en" }}</a>
            <a href="{{ link "/blog/index.html" .File.Language }}">{{ i18n "blog" .File.Language }}</a>
            <a href="{{ link "/photos.html" .File.Language }}">{{ i18n "photos" .File.Language }}</a>
            <h1>{{ .Title }}</h1>
        </div>
    </div>
</div>

<div class="wrapper">
{{/* collect all .Type in array */}}
{{ $types := mkslice }}
{{ range .Items }}
{{ if eq (len .Type) 0 }}{{ continue }}{{ end }}
{{ $types = ($types | append .Type) }}
{{ end }}
{{/* remove duplicates */}}
{{ $types = $types | uniq }}
{{/* sort the slice */}}
{{ $types = $types | sort }}
{{/* loop over the slice */}}
{{ if gt (len $types) 0 }}
<ul class="filter" id="filter">
{{ range $types }}
<li><a href="#{{ . }}">{{ . }}</a></li>
{{ end }}
</ul>
{{ end }}

<div class="items">
{{ range .Items }}
<a class="item" href="{{ .URL }}" data-type="{{ .Type }}" style="--image: url('{{ .Image }}')">
    <div class="image"></div>
    <div class="info">
        <span class="name">{{ .Name }}</span>
        <span class="price">{{ .Price }}</span>
        <span class="type">{{ .Type }}</span>
    </div>
</a>
{{ end }}
</div>
</div>

<script>
var filterEl = document.getElementById("filter");
var filterItems = filterEl.getElementsByTagName("a");

var items = document.getElementsByClassName("item");

function filter(type, event) {
    /* if type is empty, show all items */
    if (type == "") {
        for (var i = 0; i < items.length; i++) {
            items[i].style.display = "flex";
        }
        /* remove active class from all filter items */
        for (var i = 0; i < filterItems.length; i++) {
            filterItems[i].classList.remove("active");
        }
        /* remove hash from url */
        window.location.hash = "";
        event.preventDefault();
        return;
    }

    /* update active class on filter items */
    for (var i = 0; i < filterItems.length; i++) {
        if (filterItems[i].hash == "#" + type) {
            filterItems[i].classList.add("active");
        } else {
            filterItems[i].classList.remove("active");
        }
    }

    /* hide items that don't match the filter */
    for (var i = 0; i < items.length; i++) {
        if (items[i].dataset.type != type) {
            items[i].style.display = "none";
        } else {
            items[i].style.display = "flex";
        }
    }
}

/* on start check anchor link */
window.onload = function() {
    if (window.location.hash) {
        filter(window.location.hash.substring(1));
    }
};
/* if anchor link is clicked */
window.onhashchange = function() {
    if (window.location.hash) {
        filter(window.location.hash.substring(1));
    }
};
/* second click on anchor link - disable filter */
for (var i = 0; i < filterItems.length; i++) {
    filterItems[i].addEventListener("click", function(e) {
        if (e.target.hash == window.location.hash) {
            filter("", e);
        }
    });
}

</script>
</body>
</html>
